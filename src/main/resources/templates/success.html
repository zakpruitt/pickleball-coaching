<!DOCTYPE html>
<html>

<head>
    <title>Payment Success</title>
</head>

<body>
<h1>Thank you for your payment!</h1>
<p>Your order is being processed. Please wait...</p>

<script>
    window.addEventListener('load', async () => {
        const urlParams = new URLSearchParams(window.location.search);
        const sessionId = urlParams.get('session_id');

        if (sessionId) {
            // Retrieve order details and paymentId from session storage
            const orderDetails = JSON.parse(sessionStorage.getItem('orderDetails'));
            const paymentId = sessionStorage.getItem('paymentId');

            if (orderDetails && paymentId) {
                const finalizeResponse = await fetch(`http://localhost:8080/api/payments/finalize?paymentId=${paymentId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(orderDetails)
                });

                if (finalizeResponse.status === 200) {
                    alert('Order created successfully!');
                    sessionStorage.removeItem('orderDetails');
                    sessionStorage.removeItem('paymentId');
                } else {
                    alert('Order creation failed. Please contact support.');
                }
            }
        }
    });
</script>
</body>

</html>
